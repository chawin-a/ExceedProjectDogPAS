<!DOCTYPE html>
<html>
    <head>
	    <meta charset="utf-8">
	    <title></title>
        <link rel="stylesheet" href="bootstrap-3.3.5-dist/css/bootstrap.css">
        <style>
              
            
            body{
                font: grey;
                font-family: "impact";
            }
           
        </style>
    </head>
    <body background="wallpaper/Web_BG purple.png">
       <div class="col-md-2 col-md-offset-10">
           <iframe src="http://free.timeanddate.com/clock/i4sawlt4/n28/tluk/fn6/fs20/ftb/pa4/tt0/tw0/tm1/tb4" frameborder="0" width="130" height="56"></iframe>
        </div>
        <div class="container" id="firstPage">
            <div class = "row" >   
                   <br> </br>
                    <div class="col-md-12 text-center">
                        <div class = "row"  > <h2>Post code</h2> </div>
                        <div class="row">
                            <div class="col-md-6 col-md-offset-3 ">
                                <input type="text" id="postForm" class="form-control" placeholder="Post Code">
                            </div>
                        </div>
                        <br> </br>
                        <div class = "row"  > <h2>Name</h2> </div>
                        <div class="row">
                            <div class="col-md-6 col-md-offset-3 ">
                               <input type="text" id="nameForm" class="form-control" placeholder="Name">
                            </div>    
                        </div>
                        <br> </br>
                        <div class="row text-center" id="submitBtn">
                            <button type="submit" class="btn btn-success" id="submitBtn">Submit</button>
                        </div>
                        <br> </br>
                        <div class="row text-center" id="back">
                            <a href="mailBoxMain.html">
                                <button class="btn btn-danger" id="backBtn">Back</button>
                            </a>
                        </div>
                    </div>
                    
            </div> 
            
        <script src="jquery-2.1.4.min.js"></script>

        <script>
            var postFm = $("#postForm");
            var nameFm = $("#nameForm");
            var submitBtn = $("#submitBtn");
            var name;
            var code;
            var passwords;
            var temp;
            var temp2;
            var isValid = true;
            
            function init(){
                name = "";
                code = "";
                passwords = "";
                temp = "";
                temp2 = "";
                isValid = true;
            }
            
            function clearPass(){
                $.post("http://exceed.cupco.de/iot/kculdees/password",{data: "post@name"});
                $.post("http://exceed.cupco.de/iot/kculdees/park",{data: ""});
                console.log("clear");
            }
            
            function checkPass(){
                for(var i=0;i<passwords.length;i++){
                    temp2 = passwords[i].split("@");
                    console.log(code + temp2[0] + "=" +code+""==temp2[0]);
                    if(code==temp2[0]) isValid = false;1
                }
                clearText();
                pop();
            }
            
            function pop(){
                console.log(isValid);
                if(isValid){ 
                   popUp();
                   addToServ();
                }
               else InvalidPopUp();
                //else console.log("fail");
                init();
            }
            
            function submitPress(){
//                clearPass();
                getPassFormServ();   
            }
            
            function clearText(){
                postFm.val("");
                nameFm.val("");
            }
            
            function getData(massage){
                temp = massage;
                passwords = temp.split("_");
                getPass();
            }
            
            function getPassFormServ(){
               $.get("http://exceed.cupco.de/iot/kculdees/password", getData);
            }
            
            function getPass(){
                name = nameFm.val();
                code = postFm.val();
                if(code == "")
                    isValid = false; 
                checkPass();
            }
            
            function popUp(){
                window.alert("Success");
            }
            
            function InvalidPopUp(){
                window.alert("Fail");
            }
            
            function addToServ(){
//                if(temp==undefined)
//                    temp = "";
                temp += ("_"+code+"@"+name);
                console.log(temp);
                $.post("http://exceed.cupco.de/iot/kculdees/password",{data: temp});
            }
            
            submitBtn.click(submitPress);
        </script>
    </body>
</html>