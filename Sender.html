<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sender</title>
    <link rel="stylesheet" href="bootstrap-3.3.5-dist/css/bootstrap.css">
    <style>
        body{
                font: grey;
                font-family: "impact";
            }
        #Password{
        font-size:16px;
        }
        #TextBox{
        font-family: "impact";
        font-size: 20px;
        color: grey;
        }
    </style>

</head>
<body background="Picture/Web_BG light blue.png">
  <div id="firstPage"  >
      
<!--
      <div class="row" >
          <div class="col-md-12 text-center" >
              <img src="Picture/Opening%20background3.png" width="950">
          </div>      
      </div>
-->
      
     
      
      
      
  </div>
  
  
  
  
   <div id="secondPage">
    <div class="row">
       <div class="col-md-12 text-center">
          <br></br> 
           <h1><font color="grey">Mail Box for Sender</font></h1>  
       </div>
    </div>
    <br></br>  
    <div class="row">
            <div id="TextBox" class="col-md-12 text-center" color: red>
                Please! Enter code
            </div>
    </div>
    <br></br>  
<!--    <form id="form">-->
    <div class="row">
        <div  class="col-md-4 col-md-offset-4 text-center">
            <input type="text" id="Password" class="form-control" placeholder="Input code" height: 50px>
        </div>
        
    </div>
    <br></br> 
    <div> </div>
    <div class="row">
         <div class="col-md-12 text-center">
            <button type="submit" id="confirm" class="btn btn-primary" >Confirm</button>
    <br></br>                  
        </div>
    <div class="row">
         <div class="col-md-12 text-center">
            <button type="submit" id="finish" class="btn btn-danger" >Finish</button>
                      
        </div>
    </div>
    
    </div>
<!--     </form> -->
<script src="jquery-2.1.4.min.js"  ></script>   
<script>
    var confirm = $("#confirm");
    var clear = $("#clear");
    var password = $("#Password");
    var blueprint;
    var TextBox = $("#TextBox");
    var temp,check1,check2 = "D";
    var firstPage = $("#firstPage");
    var secondPage = $("#secondPage");
    var finBtn = $("#finish");
    var myTimeout;
    var timeOut = 5000;
    var isFirstTime = true;
    
    function init(){
        secondPage.hide();
        firstPage.fadeIn(400);
        TextBox.text("Please! Enter code");
        $.post("http://exceed.cupco.de/iot/kculdees/web",{data:"0"});
    }
    
    function clickConfirm() {
    //    myTimeout = window.setTimeout(finishPress,timeOut);
        if(password.val() != ""){
            $.post("http://exceed.cupco.de/iot/kculdees/passwordForSender",{data: password.val()});
            console.log(password.val());
            password.val("");
        }
        
    }

    function CheckPass() {
         console.log(check1);
        if(check1=="1"){
          TextBox.text("Put in the Box");
            $.post("http://exceed.cupco.de/iot/kculdees/web",{data:"1"}); //sent to board
            set0();
        }else if (check1=="2"){
            TextBox.text("Take it back");
            set0();
        }else if (check1=="3"){
            TextBox.text("Wrong Password");
            set0();
        }
    }
    function set0(){
        $.post("http://exceed.cupco.de/iot/kculdees/webToSender",{data: "0"});
    }
    function onGetdata(message) {
        check1=message;
       
        CheckPass();
    }
   
    function refreshPort() {
        //checking sender
        $.get("http://exceed.cupco.de/iot/kculdees/webToSender",onGetdata);  
    }
    
    function submitForm(){
        clickConfirm();
     //   clearTimeout(myTimeout);
        
        return false;
    }
    
    function refreshboard(){
        $.get("http://exceed.cupco.de/iot/kculdees/board",onGetdata2);
    }
    setInterval(refreshboard,1000);
    
    function onGetdata2(message) {
        check2=message;
        checkActivity();
    }
    
    function checkActivity(){
        console.log(check1);
        if(check2=="A"&&isFirstTime){//
            isFirstTime = false;//
            active();
            
        }
    }
    
    function finishPress(){
        $.post("http://exceed.cupco.de/iot/kculdees/board",{data: "D"});
//        if(myTimeout!=1)
//            clearTimeout(myTimeout);
        
        init();
    }

    function active(){
//        myTimeout = window.setTimeout(finishPress,timeOut);
        firstPage.hide();
        secondPage.fadeIn();
    }
    
    //main
        init();
        confirm.click(clickConfirm);
        setInterval(refreshPort,3000);
       finBtn.click(finishPress);

//    $("#Confirm").click(clickConfirm);
//    $("#form").submit(submitForm);
</script>    
    
</body>
</html>